
  Test test2.sh

Mount the file system

make clean
rm -r mountdir rootdir

make
mkdir -p mountdir
mkdir -p rootdir
# echo "bogus file" > rootdir/bogus.txt

  Start the test2.sh

Add the first file

ls in mountdir
total 68
-rw-rw-r-- 1 ptolou ptolou 69632 Jun  1 18:39 file1.txt

ls in rootdir
rootdir:
total 16
drwxrwxr-x 4 ptolou ptolou 4096 Jun  1 18:39 .
drwxrwxr-x 8 ptolou ptolou 4096 Jun  1 18:39 ..
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .blocks
-rw-rw-r-- 1 ptolou ptolou    0 Jun  1 18:39 file1.txt
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .metadata

rootdir/.blocks:
total 48
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .
drwxrwxr-x 4 ptolou ptolou 4096 Jun  1 18:39 ..
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 33f0d7f4de2cf6d6d91efadd40e00a934d525366
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 377a35744f67c0c3739636416c039cc748738336
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 387f369d76017840f415e5681cfb87c085cf49fe
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 5df64b8098d030ad81439e2c7653df9dcf6bc407
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 6246cfe5adbdfbadd6b6f33ea9f2bdcea3a479d2
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 6bae0c5c9982442bca8179a9a5c1d44303179374
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 7c093d9215d6f99e91fb6cf897e70e64c4d7e0d2
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 8fb3bd725a4eb80c2fd2a34f887b49284127ad12
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 aff3a08f17e2977bfc160bb498a8049129d68224
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 b8d7fac544618a21ed155a729dc08b28b8f1e201

rootdir/.metadata:
total 12
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .
drwxrwxr-x 4 ptolou ptolou 4096 Jun  1 18:39 ..
-rw-rw-r-- 1 ptolou ptolou  680 Jun  1 18:39 file1.txt

Add the second file

ls in mountdir
total 124
-rw-rw-r-- 1 ptolou ptolou 69632 Jun  1 18:39 file1.txt
-rw-rw-r-- 1 ptolou ptolou 57344 Jun  1 18:39 file2.txt

ls in rootdir
rootdir:
total 16
drwxrwxr-x 4 ptolou ptolou 4096 Jun  1 18:39 .
drwxrwxr-x 8 ptolou ptolou 4096 Jun  1 18:39 ..
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .blocks
-rw-rw-r-- 1 ptolou ptolou    0 Jun  1 18:39 file1.txt
-rw-rw-r-- 1 ptolou ptolou    0 Jun  1 18:39 file2.txt
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .metadata

rootdir/.blocks:
total 64
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .
drwxrwxr-x 4 ptolou ptolou 4096 Jun  1 18:39 ..
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 14751508a7066782b60670cdb22e3b02a085131e
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 215133c58ec8478c59281d256fe8d0947ca14901
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 33f0d7f4de2cf6d6d91efadd40e00a934d525366
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 377a35744f67c0c3739636416c039cc748738336
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 387f369d76017840f415e5681cfb87c085cf49fe
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 4dc73519659769f92994826a342e064db40e492e
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 5df64b8098d030ad81439e2c7653df9dcf6bc407
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 6246cfe5adbdfbadd6b6f33ea9f2bdcea3a479d2
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 6bae0c5c9982442bca8179a9a5c1d44303179374
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 6db6a1a34e10bd3d0ad313e86f8a0b6dbbd36cd1
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 7c093d9215d6f99e91fb6cf897e70e64c4d7e0d2
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 8fb3bd725a4eb80c2fd2a34f887b49284127ad12
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 aff3a08f17e2977bfc160bb498a8049129d68224
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 b8d7fac544618a21ed155a729dc08b28b8f1e201

rootdir/.metadata:
total 16
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .
drwxrwxr-x 4 ptolou ptolou 4096 Jun  1 18:39 ..
-rw-rw-r-- 1 ptolou ptolou  680 Jun  1 18:39 file1.txt
-rw-rw-r-- 1 ptolou ptolou  560 Jun  1 18:39 file2.txt

Remove the first file

ls in mountdir
total 56
-rw-rw-r-- 1 ptolou ptolou 57344 Jun  1 18:39 file2.txt

ls in rootdir
rootdir:
total 16
drwxrwxr-x 4 ptolou ptolou 4096 Jun  1 18:39 .
drwxrwxr-x 8 ptolou ptolou 4096 Jun  1 18:39 ..
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .blocks
-rw-rw-r-- 1 ptolou ptolou    0 Jun  1 18:39 file2.txt
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .metadata

rootdir/.blocks:
total 44
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .
drwxrwxr-x 4 ptolou ptolou 4096 Jun  1 18:39 ..
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 14751508a7066782b60670cdb22e3b02a085131e
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 215133c58ec8478c59281d256fe8d0947ca14901
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 387f369d76017840f415e5681cfb87c085cf49fe
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 4dc73519659769f92994826a342e064db40e492e
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 6246cfe5adbdfbadd6b6f33ea9f2bdcea3a479d2
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 6db6a1a34e10bd3d0ad313e86f8a0b6dbbd36cd1
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 7c093d9215d6f99e91fb6cf897e70e64c4d7e0d2
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 aff3a08f17e2977bfc160bb498a8049129d68224
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 b8d7fac544618a21ed155a729dc08b28b8f1e201

rootdir/.metadata:
total 12
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .
drwxrwxr-x 4 ptolou ptolou 4096 Jun  1 18:39 ..
-rw-rw-r-- 1 ptolou ptolou  560 Jun  1 18:39 file2.txt

Unmount the file system

ls in mountdir
total 0

ls in rootdir
rootdir:
total 20
drwxrwxr-x 4 ptolou ptolou 4096 Jun  1 18:39 .
drwxrwxr-x 8 ptolou ptolou 4096 Jun  1 18:39 ..
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .blocks
-rw-rw-r-- 1 ptolou ptolou    0 Jun  1 18:39 file2.txt
-rw-rw-r-- 1 ptolou ptolou  387 Jun  1 18:39 .load
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .metadata

rootdir/.blocks:
total 44
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .
drwxrwxr-x 4 ptolou ptolou 4096 Jun  1 18:39 ..
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 14751508a7066782b60670cdb22e3b02a085131e
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 215133c58ec8478c59281d256fe8d0947ca14901
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 387f369d76017840f415e5681cfb87c085cf49fe
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 4dc73519659769f92994826a342e064db40e492e
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 6246cfe5adbdfbadd6b6f33ea9f2bdcea3a479d2
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 6db6a1a34e10bd3d0ad313e86f8a0b6dbbd36cd1
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 7c093d9215d6f99e91fb6cf897e70e64c4d7e0d2
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 aff3a08f17e2977bfc160bb498a8049129d68224
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 b8d7fac544618a21ed155a729dc08b28b8f1e201

rootdir/.metadata:
total 12
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .
drwxrwxr-x 4 ptolou ptolou 4096 Jun  1 18:39 ..
-rw-rw-r-- 1 ptolou ptolou  560 Jun  1 18:39 file2.txt

Mount the file system

ls in mountdir
total 56
-rw-rw-r-- 1 ptolou ptolou 57344 Jun  1 18:39 file2.txt

ls in rootdir
rootdir:
total 16
drwxrwxr-x 4 ptolou ptolou 4096 Jun  1 18:39 .
drwxrwxr-x 8 ptolou ptolou 4096 Jun  1 18:39 ..
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .blocks
-rw-rw-r-- 1 ptolou ptolou    0 Jun  1 18:39 file2.txt
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .metadata

rootdir/.blocks:
total 44
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .
drwxrwxr-x 4 ptolou ptolou 4096 Jun  1 18:39 ..
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 14751508a7066782b60670cdb22e3b02a085131e
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 215133c58ec8478c59281d256fe8d0947ca14901
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 387f369d76017840f415e5681cfb87c085cf49fe
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 4dc73519659769f92994826a342e064db40e492e
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 6246cfe5adbdfbadd6b6f33ea9f2bdcea3a479d2
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 6db6a1a34e10bd3d0ad313e86f8a0b6dbbd36cd1
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 7c093d9215d6f99e91fb6cf897e70e64c4d7e0d2
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 aff3a08f17e2977bfc160bb498a8049129d68224
-rw-rw-r-- 1 ptolou ptolou 4096 Jun  1 18:39 b8d7fac544618a21ed155a729dc08b28b8f1e201

rootdir/.metadata:
total 12
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .
drwxrwxr-x 4 ptolou ptolou 4096 Jun  1 18:39 ..
-rw-rw-r-- 1 ptolou ptolou  560 Jun  1 18:39 file2.txt

Remove the second file

ls in mountdir
total 0

ls in rootdir
rootdir:
total 16
drwxrwxr-x 4 ptolou ptolou 4096 Jun  1 18:39 .
drwxrwxr-x 8 ptolou ptolou 4096 Jun  1 18:39 ..
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .blocks
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .metadata

rootdir/.blocks:
total 8
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .
drwxrwxr-x 4 ptolou ptolou 4096 Jun  1 18:39 ..

rootdir/.metadata:
total 8
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .
drwxrwxr-x 4 ptolou ptolou 4096 Jun  1 18:39 ..

Unmount the file system

ls in mountdir
total 0

ls in rootdir
rootdir:
total 16
drwxrwxr-x 4 ptolou ptolou 4096 Jun  1 18:39 .
drwxrwxr-x 8 ptolou ptolou 4096 Jun  1 18:39 ..
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .blocks
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .metadata

rootdir/.blocks:
total 8
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .
drwxrwxr-x 4 ptolou ptolou 4096 Jun  1 18:39 ..

rootdir/.metadata:
total 8
drwx------ 2 ptolou ptolou 4096 Jun  1 18:39 .
drwxrwxr-x 4 ptolou ptolou 4096 Jun  1 18:39 ..

Test test2.sh finished
