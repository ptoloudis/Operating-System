
  Test test3.sh

Mount the file system
mkdir -p mountdir
mkdir -p rootdir
# echo "bogus file" > rootdir/bogus.txt

  Start the test3.sh

Add the first file

ls in mountdir
total 20
-rw-rw-r-- 1 ptolou ptolou 19451 May 31 19:31 file1.txt

ls in rootdir
rootdir:
total 16
drwxrwxr-x 4 ptolou ptolou 4096 May 31 19:31 .
drwxrwxr-x 8 ptolou ptolou 4096 May 31 19:27 ..
drwx------ 2 ptolou ptolou 4096 May 31 19:31 .blocks
-rw-rw-r-- 1 ptolou ptolou    0 May 31 19:31 file1.txt
drwx------ 2 ptolou ptolou 4096 May 31 19:31 .metadata

rootdir/.blocks:
total 28
drwx------ 2 ptolou ptolou 4096 May 31 19:31 .
drwxrwxr-x 4 ptolou ptolou 4096 May 31 19:31 ..
-rw-rw-r-- 1 ptolou ptolou 4096 May 31 19:31 323af8352998a9305463a5f2ef4035c392210efa
-rw-rw-r-- 1 ptolou ptolou 4096 May 31 19:31 8e34d64c770ca735f6dedada2137aee122f27fbd
-rw-rw-r-- 1 ptolou ptolou 4096 May 31 19:31 c09e0103195ca9e7093231422d0e90e1b1498d44
-rw-rw-r-- 1 ptolou ptolou 4096 May 31 19:31 c7a0a993c296539f3f700ec4e482694f226449f8
-rw-rw-r-- 1 ptolou ptolou 3067 May 31 19:31 f283e31f52282a1cefa9c5b712678f8b15f771be

rootdir/.metadata:
total 12
drwx------ 2 ptolou ptolou 4096 May 31 19:31 .
drwxrwxr-x 4 ptolou ptolou 4096 May 31 19:31 ..
-rw-rw-r-- 1 ptolou ptolou  200 May 31 19:31 file1.txt

Add the second file

ls in mountdir
total 40
-rw-rw-r-- 1 ptolou ptolou 19451 May 31 19:31 file1.txt
-rw-rw-r-- 1 ptolou ptolou 20480 May 31 19:31 file2.txt

ls in rootdir
rootdir:
total 16
drwxrwxr-x 4 ptolou ptolou 4096 May 31 19:31 .
drwxrwxr-x 8 ptolou ptolou 4096 May 31 19:27 ..
drwx------ 2 ptolou ptolou 4096 May 31 19:31 .blocks
-rw-rw-r-- 1 ptolou ptolou    0 May 31 19:31 file1.txt
-rw-rw-r-- 1 ptolou ptolou    0 May 31 19:31 file2.txt
drwx------ 2 ptolou ptolou 4096 May 31 19:31 .metadata

rootdir/.blocks:
total 40
drwx------ 2 ptolou ptolou 4096 May 31 19:31 .
drwxrwxr-x 4 ptolou ptolou 4096 May 31 19:31 ..
-rw-rw-r-- 1 ptolou ptolou 4096 May 31 19:31 033898c13b67ff82c8562f3ccdd93b5fa376fe49
-rw-rw-r-- 1 ptolou ptolou 4096 May 31 19:31 15ebb3d8eb981f1cfc1e5612d56dcf5bd8c165a0
-rw-rw-r-- 1 ptolou ptolou 4096 May 31 19:31 1b61a5f6635d65dfc346f448c35c5e1890176007
-rw-rw-r-- 1 ptolou ptolou 4096 May 31 19:31 323af8352998a9305463a5f2ef4035c392210efa
-rw-rw-r-- 1 ptolou ptolou 4096 May 31 19:31 8e34d64c770ca735f6dedada2137aee122f27fbd
-rw-rw-r-- 1 ptolou ptolou 4096 May 31 19:31 c09e0103195ca9e7093231422d0e90e1b1498d44
-rw-rw-r-- 1 ptolou ptolou 4096 May 31 19:31 c7a0a993c296539f3f700ec4e482694f226449f8
-rw-rw-r-- 1 ptolou ptolou 3067 May 31 19:31 f283e31f52282a1cefa9c5b712678f8b15f771be

rootdir/.metadata:
total 16
drwx------ 2 ptolou ptolou 4096 May 31 19:31 .
drwxrwxr-x 4 ptolou ptolou 4096 May 31 19:31 ..
-rw-rw-r-- 1 ptolou ptolou  200 May 31 19:31 file1.txt
-rw-rw-r-- 1 ptolou ptolou  200 May 31 19:31 file2.txt

Remove the first file

ls in mountdir
total 20
-rw-rw-r-- 1 ptolou ptolou 20480 May 31 19:31 file2.txt

ls in rootdir
rootdir:
total 16
drwxrwxr-x 4 ptolou ptolou 4096 May 31 19:31 .
drwxrwxr-x 8 ptolou ptolou 4096 May 31 19:27 ..
drwx------ 2 ptolou ptolou 4096 May 31 19:31 .blocks
-rw-rw-r-- 1 ptolou ptolou    0 May 31 19:31 file2.txt
drwx------ 2 ptolou ptolou 4096 May 31 19:31 .metadata

rootdir/.blocks:
total 28
drwx------ 2 ptolou ptolou 4096 May 31 19:31 .
drwxrwxr-x 4 ptolou ptolou 4096 May 31 19:31 ..
-rw-rw-r-- 1 ptolou ptolou 4096 May 31 19:31 033898c13b67ff82c8562f3ccdd93b5fa376fe49
-rw-rw-r-- 1 ptolou ptolou 4096 May 31 19:31 15ebb3d8eb981f1cfc1e5612d56dcf5bd8c165a0
-rw-rw-r-- 1 ptolou ptolou 4096 May 31 19:31 1b61a5f6635d65dfc346f448c35c5e1890176007
-rw-rw-r-- 1 ptolou ptolou 4096 May 31 19:31 323af8352998a9305463a5f2ef4035c392210efa
-rw-rw-r-- 1 ptolou ptolou 4096 May 31 19:31 c7a0a993c296539f3f700ec4e482694f226449f8

rootdir/.metadata:
total 12
drwx------ 2 ptolou ptolou 4096 May 31 19:31 .
drwxrwxr-x 4 ptolou ptolou 4096 May 31 19:31 ..
-rw-rw-r-- 1 ptolou ptolou  200 May 31 19:31 file2.txt

Remove the first file

ls in mountdir
total 0

ls in rootdir
rootdir:
total 16
drwxrwxr-x 4 ptolou ptolou 4096 May 31 19:31 .
drwxrwxr-x 8 ptolou ptolou 4096 May 31 19:27 ..
drwx------ 2 ptolou ptolou 4096 May 31 19:31 .blocks
drwx------ 2 ptolou ptolou 4096 May 31 19:31 .metadata

rootdir/.blocks:
total 8
drwx------ 2 ptolou ptolou 4096 May 31 19:31 .
drwxrwxr-x 4 ptolou ptolou 4096 May 31 19:31 ..

rootdir/.metadata:
total 8
drwx------ 2 ptolou ptolou 4096 May 31 19:31 .
drwxrwxr-x 4 ptolou ptolou 4096 May 31 19:31 ..

Unmount the file system

ls in mountdir
total 0

ls in rootdir
rootdir:
total 16
drwxrwxr-x 4 ptolou ptolou 4096 May 31 19:31 .
drwxrwxr-x 8 ptolou ptolou 4096 May 31 19:27 ..
drwx------ 2 ptolou ptolou 4096 May 31 19:31 .blocks
drwx------ 2 ptolou ptolou 4096 May 31 19:31 .metadata

rootdir/.blocks:
total 8
drwx------ 2 ptolou ptolou 4096 May 31 19:31 .
drwxrwxr-x 4 ptolou ptolou 4096 May 31 19:31 ..

rootdir/.metadata:
total 8
drwx------ 2 ptolou ptolou 4096 May 31 19:31 .
drwxrwxr-x 4 ptolou ptolou 4096 May 31 19:31 ..

Test test3.sh finished
